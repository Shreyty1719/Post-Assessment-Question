package Questions;

import java.util.ArrayList;
import java.util.*;
import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;

public class vulnerabilityByMe {

	
	public static List<String>  ScrapeVulnerability(WebDriver driver,String url,String wpVersion) {
		List<String> cveid=new ArrayList<>();
		driver.get(url);
		List<WebElement> header=driver.findElements(By.tagName("th"));
		HashMap<String,Integer> map=new HashMap<>();
		
		for(int i=0;i<header.size();i++) {
			String text=header.get(i).getText().trim();
			map.put(text, i);
		}
		int versionIndex=map.get("WordPress Version");
		
		int idIndex=map.get("CVE ID");
		List<WebElement> rows=driver.findElements(By.tagName("tr"));
		for(int i=1;i<rows.size();i++) {
			
			
			List<WebElement> cellData=rows.get(i).findElements(By.tagName("td"));
			
			
			
			
			String version=cellData.get(versionIndex).getText();
			if(version.equals(wpVersion)) {
				cveid.add(cellData.get(idIndex).getText());
			}
			
			
		}
		
		return cveid;
	}
 	
	public static List<String> Topvulnerability(WebDriver driver,String url,String wpVersion){
		List<String> cvied=new ArrayList<>();
		List<WebElement> header=driver.findElements(By.tagName("th"));
		HashMap<String,Integer> map=new HashMap<>();
		
		for(int i=0;i<header.size();i++) {
			String text=header.get(i).getText().trim();
			map.put(text, i);
		}
		
		int versionIndex=map.get("WordPress Version");
		driver.get(url);
		int idIndex=map.get("CVE ID");
		int scoreIndex=map.get("Score");
		String maxID="";
		List<WebElement> rows=driver.findElements(By.tagName("tr"));
		Double max=0.0;
		for(int i=1;i<rows.size();i++) {
			List<WebElement> cellData=rows.get(i).findElements(By.tagName("td"));
			String version=cellData.get(versionIndex).getText();
			if(version.equals(wpVersion)) {
				if(Double.parseDouble(cellData.get(scoreIndex).getText())>max) {
					maxID=cellData.get(idIndex).getText();
					max=Double.parseDouble(cellData.get(scoreIndex).getText());
				}
			}
		}
		cvied.add(maxID);
		return cvied;
		
	}
	public static void main(String args[]) {
		System.setProperty("webdriver.chrome.driver","c:/Java Software/chromedriver-win64/chromedriver.exe");
		WebDriver driver=new ChromeDriver();
		
		String url="C:\\Users\\shreya-tyagi\\Downloads\\Selenium-practice-html-code 1 1\\Selenium-practice-html-code 1\\Vuln-practice\\vuln-page.html";
		System.out.println(ScrapeVulnerability(driver,url,"4.3"));
		System.out.println(Topvulnerability(driver,url,"4.5"));
		
	}
}
